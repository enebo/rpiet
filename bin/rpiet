#!/usr/bin/env ruby

require 'optparse'
require 'rpiet'
require 'rpiet/image/url_image'

codel_size = 1

log = RPiet::Logger::NoOutput
opts = OptionParser.new do |opts|
  opts.banner = "Usage: #{__FILE__} -d image_file"

  opts.on("-d", "--debug style", "turn on debugging") do |style|
    log = case style
    when 'simple'
      RPiet::Logger::SimpleAsciiOutput
    when 'complex'
      RPiet::Logger::ComplexAsciiOutput
    end
  end
  opts.on("-c", "--codel-size w", "size of codel") { |w| codel_size = w.to_i }
end

opts.parse!(ARGV)
opts.usage("You need to supply a source image filename.") unless ARGV.first

filename = ARGV.first
filename = 'file:' + ARGV.first if File.exist? filename
image = RPiet::Image::URLImage.new(filename, codel_size)
RPiet::Interpreter.new(image, log.new).run
